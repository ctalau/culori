import { useState, useCallback } from 'react';

export default function VirtualFlute() {
  const [activeHoles, setActiveHoles] = useState<boolean[]>(new Array(8).fill(false));

  const playNote = useCallback((frequency: number) => {
    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);

    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
    oscillator.type = 'sine';

    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
  }, []);

  const handleHoleClick = useCallback((index: number) => {
    const newActiveHoles = [...activeHoles];
    newActiveHoles[index] = !newActiveHoles[index];
    setActiveHoles(newActiveHoles);

    // Define frequencies for each hole (in Hz)
    const frequencies = [523, 587, 659, 698, 784, 880, 988, 1047]; // C5, D5, E5, F5, G5, A5, B5, C6
    playNote(frequencies[index]);
  }, [activeHoles, playNote]);

  const resetFlute = useCallback(() => {
    setActiveHoles(new Array(8).fill(false));
  }, []);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
      <div className="max-w-4xl mx-auto">
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-800 mb-4">Virtual Flute</h1>
          <p className="text-lg text-gray-600 mb-6">
            Click on the holes to play different notes!
          </p>
          <button
            onClick={resetFlute}
            className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition-colors duration-200"
          >
            Reset Flute
          </button>
        </div>

        <div className="flex flex-col items-center">
          {/* Flute Body */}
          <div className="relative bg-gradient-to-r from-amber-200 to-amber-300 rounded-full p-8 shadow-2xl">
            <div className="flex items-center space-x-6">
              {/* Mouthpiece */}
              <div className="bg-gradient-to-r from-amber-300 to-amber-400 rounded-full w-16 h-12 shadow-inner flex items-center justify-center">
                <div className="w-2 h-2 bg-gray-700 rounded-full"></div>
              </div>

              {/* Flute Tube */}
              <div className="bg-gradient-to-r from-amber-100 to-amber-200 rounded-full h-8 w-96 shadow-inner relative">
                {/* Finger Holes */}
                <div className="absolute inset-0 flex items-center justify-around">
                  {activeHoles.map((isActive, index) => (
                    <button
                      key={index}
                      onClick={() => handleHoleClick(index)}
                      className={`
                        w-8 h-8 rounded-full border-2 border-gray-700 shadow-md transition-colors duration-200
                        ${isActive ? 'bg-indigo-600' : 'bg-white'}
                      `}
                      aria-label={`Hole ${index + 1} ${isActive ? 'pressed' : 'not pressed'}`}
                    />
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
